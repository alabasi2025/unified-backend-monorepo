// Prisma Schema for SEMOP ERP System
// Version: 2.1.10
// Date: 2025-11-27

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// Cycle 4 - New Models (6 tables)
// ============================================

// 1. Genes System
model Gene {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  symbol      String   @unique
  description String?
  category    String   // ACCOUNTING, INVENTORY, SALES, PURCHASES
  geneType    String   @map("gene_type") // PUBLIC, PRIVATE
  sectorId    String?  @map("sector_id")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("genes")
}

// 2. Latitude Points (Maps System)
model LatitudePoint {
  id          Int      @id @default(autoincrement())
  latitude    Float
  longitude   Float
  pointName   String   @unique @map("point_name")
  description String?
  address     String?
  city        String?
  country     String?  @default("Yemen")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("latitude_points")
}

// 3. Purchase Orders
model PurchaseOrder {
  id           String   @id @default(uuid())
  orderNumber  String   @unique @map("order_number")
  supplierId   String   @map("supplier_id")
  orderDate    DateTime @default(now()) @map("order_date")
  deliveryDate DateTime? @map("delivery_date")
  status       String   @default("Pending") // Pending, Approved, Rejected, Completed
  totalAmount  Float    @map("total_amount")
  notes        String?
  createdBy    String?  @map("created_by")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("purchase_orders")
}

// 4. Account Hierarchy
model AccountHierarchy {
  id            String   @id @default(uuid())
  accountId     String   @unique @map("account_id")
  parentId      String?  @map("parent_id")
  level         Int      @default(1)
  path          String   // e.g., "1.2.3"
  name          String
  description   String?
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@map("account_hierarchy")
}

// 5. Role Permissions
model RolePermission {
  id           String   @id @default(uuid())
  roleId       String   @map("role_id")
  permissionId String   @map("permission_id")
  canCreate    Boolean  @default(false) @map("can_create")
  canRead      Boolean  @default(true) @map("can_read")
  canUpdate    Boolean  @default(false) @map("can_update")
  canDelete    Boolean  @default(false) @map("can_delete")
  assignedBy   String?  @map("assigned_by")
  assignedAt   DateTime @default(now()) @map("assigned_at")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@unique([roleId, permissionId])
  @@map("role_permissions")
}

// 6. Customer Contacts
model CustomerContact {
  id          Int      @id @default(autoincrement())
  customerId  String   @map("customer_id")
  contactName String   @map("contact_name")
  email       String?
  phone       String?
  position    String?
  isPrimary   Boolean  @default(false) @map("is_primary")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("customer_contacts")
}
